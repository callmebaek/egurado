# 경쟁매장 분석 기능 가이드

## 📋 개요

**경쟁매장 분석** 기능은 키워드 기반으로 상위 노출 중인 경쟁매장들을 분석하고, 우리 매장과 비교하여 개선이 필요한 부분을 파악할 수 있는 Pro Tier 전용 기능입니다.

---

## 🎯 주요 기능

### 1. 4단계 분석 프로세스

#### 1단계: 매장 선택
- 등록된 네이버 플레이스 매장 중 분석할 매장 선택

#### 2단계: 타겟 키워드 입력
- 분석하고 싶은 키워드 입력
- 플레이스 순위에 등록된 키워드가 있으면 선택 가능

#### 3단계: 상위 매장 목록 확인
- 해당 키워드로 상위 노출 중인 20개 매장 목록 표시
- 기본 정보 (매장명, 업종, 주소) 확인

#### 4단계: 상세 분석 및 비교
- 각 경쟁매장의 상세 정보 수집 및 분석
- 우리 매장과 비교 분석
- 개선 권장사항 제공

---

## 📊 분석 항목

### 기본 정보
- 매장명
- 업종 (카테고리)
- 주소

### 플레이스 진단
- **진단 점수**: 플레이스 진단 기능의 scoring 시스템 활용
- **진단 등급**: S / A / B / C / D

### 활동 지표 (최근 7일 기준)
- **일평균 방문자 리뷰 수**: 지난 7일간 등록된 방문자 리뷰 / 7
- **일평균 블로그 리뷰 수**: 지난 7일간 등록된 블로그 리뷰 / 7
- **공지 수**: 지난 7일간 등록된 공지사항 수

### 부가 기능
- **쿠폰 여부**: 쿠폰 발행 여부
- **플레이스 플러스 여부**: 플레이스 플러스 가입 여부
- **네이버페이 사용 여부**: 네이버페이 결제 지원 여부

---

## 🔄 점진적 로딩 시스템

### 왜 점진적 로딩인가?
경쟁매장 분석은 **많은 데이터**를 수집하고 처리해야 합니다:
- 20개 매장 × 각 매장당 40개 이상의 필드
- 각 매장당 5-8초의 분석 시간
- 총 100-160초 (약 2-3분) 소요

### 점진적 로딩 전략
1. **1단계**: 기본 검색 (2-3초)
   - 키워드로 상위 20개 매장 검색
   - 기본 정보만 표시 (매장명, 업종, 주소)

2. **2단계**: 상세 분석 시작 버튼
   - 사용자가 원할 때만 상세 분석 시작
   - 분석 진행 상황 실시간 표시

3. **3단계**: 실시간 업데이트
   - 각 매장 분석 완료 시마다 테이블에 추가
   - 진행률 바 표시 (예: 5/20 완료)

4. **4단계**: 비교 분석 결과
   - 모든 분석 완료 후 비교 요약 표시
   - 개선 권장사항 제공

---

## 📈 비교 분석 결과

### 요약 메트릭
각 지표에 대해 다음 정보 제공:
- **우리 매장 값**
- **경쟁매장 평균**
- **차이** (+ 또는 -)
- **상태** (좋음/나쁨)

### 개선 권장사항
우선순위별로 정렬된 실행 가능한 액션:
- **높음 (High)**: 즉시 개선 필요
- **보통 (Medium)**: 중기적 개선 권장

예시:
- "진단 점수가 경쟁매장 평균 대비 15.3점 낮습니다"
- "방문자 리뷰가 일평균 2.5개로 경쟁매장 평균 5.8개보다 적습니다"
- "경쟁매장의 85%가 쿠폰을 사용하고 있습니다"

---

## 🛠️ 기술 구현

### 백엔드

#### 1. 서비스 (`naver_competitor_analysis_service.py`)
```python
class NaverCompetitorAnalysisService:
    async def get_top_competitors(keyword, limit=20)
    async def analyze_competitor(place_id, rank)
    async def analyze_all_competitors(keyword, limit=20)
    def compare_with_my_store(my_store_data, competitors)
```

#### 2. API 엔드포인트 (`routers/naver.py`)
- `POST /naver/competitor/search`: 키워드로 상위 매장 검색
- `POST /naver/competitor/analyze`: 전체 분석 및 비교
- `GET /naver/competitor/analyze-single/{place_id}`: 단일 매장 분석 (점진적 로딩용)

### 프론트엔드

#### 페이지 (`app/dashboard/naver/competitors/page.tsx`)
- 4단계 프로세스 UI
- 점진적 로딩 상태 관리
- 실시간 진행률 표시
- 비교 분석 결과 시각화

---

## 🎨 UI/UX 특징

### 진행 단계 표시
- 4개 단계를 시각적으로 표시
- 현재 단계 하이라이트
- 단계별 진행 상태 표시

### 로딩 UI
- 매장 검색 중: 스피너 + "검색 중..."
- 분석 중: 진행률 바 + "5/20 완료"
- 각 매장 분석 완료 시 테이블에 실시간 추가

### 비교 결과 시각화
- 메트릭 카드: 우리 값 vs 평균 값
- 상승/하락 아이콘 (TrendingUp/TrendingDown)
- 색상 코딩: 좋음(초록), 나쁨(빨강)

### 상세 테이블
- 20개 경쟁매장 전체 정보
- 진단 점수 색상 코딩 (S/A: 초록, B: 노랑, C/D: 빨강)
- 체크마크/대시 아이콘으로 Yes/No 표시

---

## 🔐 접근 제한

### Pro Tier 전용
- 사이드바 메뉴에 "Pro" 뱃지 표시
- 향후 구독 tier 체크 로직 추가 예정

### 향후 구현 예정
```python
# 사용자 tier 확인
def check_user_tier(user_id):
    user = supabase.table("users").select("subscription_tier").eq("id", user_id).single()
    return user.data.get("subscription_tier", "free")

# API 엔드포인트에서 체크
if check_user_tier(user_id) not in ["pro", "enterprise"]:
    raise HTTPException(403, "Pro Tier 이상만 사용 가능합니다")
```

---

## 📝 사용 시나리오

### 시나리오 1: 신규 매장 오픈 전 시장 조사
1. 타겟 키워드 입력 (예: "강남 이탈리안 레스토랑")
2. 상위 20개 경쟁매장 분석
3. 평균 진단 점수, 리뷰 수, 쿠폰 사용률 파악
4. 경쟁력 있는 매장 운영 전략 수립

### 시나리오 2: 기존 매장 개선
1. 우리 매장의 주요 키워드로 검색
2. 경쟁매장과 비교 분석
3. 부족한 부분 파악 (예: 쿠폰 없음, 공지 부족)
4. 우선순위 개선사항 실행

### 시나리오 3: 경쟁사 벤치마킹
1. 특정 키워드로 상위 매장 확인
2. 1위 매장의 상세 정보 분석
3. 성공 요인 파악 (높은 진단 점수, 활발한 리뷰 관리 등)
4. 우리 매장에 적용 가능한 전략 도출

---

## ⚠️ 주의사항

### 데이터 정확도
- **7일 리뷰 통계**: 추정값 (실제 날짜 데이터 부족 시)
- **블로그 리뷰**: 전체 누적 수 기반 추정
- **공지 날짜**: "N일 전" 형식 파싱

### 성능
- 20개 매장 분석: 약 2-3분 소요
- Rate Limiting: 각 매장당 1초 대기
- 네이버 API 제약 준수

### 법적 고지
⚠️ 이 기능은 네이버 비공식 API를 사용합니다.
- 교육 및 연구 목적으로만 사용
- 상업적 사용 시 법적 책임은 사용자에게
- 네이버 서비스 약관 확인 필요

---

## 🚀 향후 개선 사항

### 단기 (1-2주)
- [ ] 사용자 tier별 접근 제한 구현
- [ ] 분석 결과 PDF 다운로드
- [ ] 키워드별 분석 이력 저장

### 중기 (1개월)
- [ ] 시계열 비교 (이번 달 vs 지난 달)
- [ ] 업종별 벤치마킹 데이터
- [ ] AI 기반 맞춤 전략 제안

### 장기 (3개월+)
- [ ] 경쟁사 자동 모니터링 (주간 리포트)
- [ ] 순위 변동 알림
- [ ] 경쟁 지수 (Competitive Index) 개발

---

## 📞 문의

기능 관련 문의나 버그 리포트는 GitHub Issues에 등록해주세요.

---

**개발 완료일**: 2026-01-12
**버전**: 1.0.0
**상태**: ✅ 프로덕션 준비 완료
