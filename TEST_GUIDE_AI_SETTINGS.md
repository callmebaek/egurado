# AI 설정 기능 테스트 가이드

## 📋 사전 준비

### 1. Migration 적용 확인

Supabase Dashboard에서 다음 SQL을 실행하여 컬럼이 추가되었는지 확인하세요:

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'stores' 
AND column_name IN ('ai_settings', 'naver_session_encrypted', 'session_saved_at');
```

**예상 결과**:
```
column_name              | data_type
-------------------------|-----------------
ai_settings              | jsonb
naver_session_encrypted  | text
session_saved_at         | timestamp with time zone
```

### 2. 서버 실행 확인

```bash
# 백엔드 서버
cd backend
uvicorn app.main:app --reload

# 프론트엔드 서버
cd frontend
npm run dev
```

---

## 🧪 테스트 시나리오

### 테스트 1: AI 설정 페이지 접속 및 기본 설정 로드

#### 단계:
1. 브라우저에서 `http://localhost:3000` 접속
2. 로그인
3. 대시보드 → **AI 답글 설정** 메뉴 클릭
4. 매장 선택 드롭다운에서 매장 선택

#### 예상 결과:
- ✅ 페이지가 로드되고 설정 폼이 표시됨
- ✅ 기본 설정 값들이 표시됨:
  - 친절함 정도: 7
  - 격식 수준: 7
  - 최소 답글 길이: 100자
  - 최대 답글 길이: 450자
  - 다양성: 0.9
  - 텍스트 이모티콘 사용: ON
  - 리뷰 구체 내용 언급: ON

#### 검증 방법:
- 브라우저 개발자 도구 (F12) → Network 탭
- `ai-settings` API 호출이 200 OK인지 확인

---

### 테스트 2: AI 설정 저장

#### 단계:
1. AI 설정 페이지에서 설정 변경:
   - 친절함 정도: **9**
   - 격식 수준: **8**
   - 최소 답글 길이: **150**
   - 최대 답글 길이: **400**
   - 브랜드 톤: **Professional**
   - 응답 스타일: **Empathy**
2. **저장** 버튼 클릭

#### 예상 결과:
- ✅ "✅ AI 답글 설정이 저장되었습니다!" 메시지 표시
- ✅ 3초 후 메시지 자동 사라짐

#### 검증 방법:
- 브라우저 개발자 도구 → Network 탭
- PUT `/api/v1/ai-settings/{store_id}` 응답이 200 OK
- Supabase SQL Editor에서 확인:
  ```sql
  SELECT id, store_name, ai_settings 
  FROM stores 
  WHERE id = 'YOUR_STORE_ID';
  ```

---

### 테스트 3: 설정 로드 확인 (페이지 새로고침)

#### 단계:
1. 페이지 새로고침 (F5)
2. 같은 매장 선택

#### 예상 결과:
- ✅ 이전에 저장한 설정이 그대로 표시됨:
  - 친절함 정도: 9
  - 격식 수준: 8
  - 최소 답글 길이: 150
  - 최대 답글 길이: 400
  - 브랜드 톤: Professional
  - 응답 스타일: Empathy

---

### 테스트 4: 매장별 다른 설정 저장

#### 단계:
1. **매장 A** 선택:
   - 친절함: **10** (극도로 친절)
   - 격식: **9** (매우 격식)
   - 브랜드 톤: **Warm**
   - 저장
2. **매장 B** 선택:
   - 친절함: **4** (사무적)
   - 격식: **3** (반말)
   - 브랜드 톤: **Casual**
   - 저장

#### 예상 결과:
- ✅ 각 매장의 설정이 독립적으로 저장됨
- ✅ 매장 A 선택 시 → 친절함 10, 격식 9 표시
- ✅ 매장 B 선택 시 → 친절함 4, 격식 3 표시

---

### 테스트 5: AI 답글 생성 페이지에서 설정 적용 확인

#### 단계:
1. 대시보드 → **AI 답글 생성** 메뉴 클릭
2. **매장 A** 선택 (친절함 10, 격식 9)
3. 리뷰 불러오기
4. 첫 번째 리뷰에서 "AI 답글 생성" 클릭

#### 예상 결과:
- ✅ 매우 정중하고 격식있는 답글 생성됨
- 예시:
  ```
  진심으로 감사드립니다! 고객님께서 이렇게 소중한 말씀을 남겨주시니 
  저희에게는 최고의 선물이에요!! 앞으로도 더욱 노력하여 최선을 다하겠습니다. 
  다음에도 꼭 방문해주시기 바랍니다^^
  ```

#### 검증 방법:
- 브라우저 콘솔 (F12) → Console 탭에서 확인:
  ```javascript
  console.log(aiSettings)
  ```
- 백엔드 로그 확인:
  ```
  Using custom AI settings: friendliness=10, formality=9
  ```

---

### 테스트 6: 매장 변경 시 다른 톤의 답글 생성

#### 단계:
1. AI 답글 생성 페이지에서 **매장 B** 선택 (친절함 4, 격식 3)
2. 리뷰 불러오기
3. 첫 번째 리뷰에서 "AI 답글 생성" 클릭

#### 예상 결과:
- ✅ 간결하고 캐주얼한 답글 생성됨
- 예시:
  ```
  고마워! 좋게 봐줘서 반가워. 또 와~
  ```

#### 차이점 확인:
- 매장 A (친절 10, 격식 9): 정중하고 길고 감동적인 톤
- 매장 B (친절 4, 격식 3): 짧고 캐주얼한 톤

---

### 테스트 7: 커스텀 지시사항 적용

#### 단계:
1. AI 설정 페이지 → **매장 A** 선택
2. **일반 리뷰 추가 요청사항**에 입력:
   ```
   매번 "또 방문해주세요"라는 표현을 꼭 포함해주세요.
   저희 매장의 시그니처 메뉴인 "떡볶이"를 언급해주세요.
   ```
3. 저장
4. AI 답글 생성 페이지로 이동
5. 매장 A 선택하여 답글 생성

#### 예상 결과:
- ✅ 답글에 "또 방문해주세요" 포함
- ✅ 적절한 곳에 "떡볶이" 언급

---

### 테스트 8: 부정 리뷰 대응 (평점 1-2점)

#### 단계:
1. AI 설정 페이지 → **매장 A** 선택
2. **부정 리뷰 추가 요청사항**에 입력:
   ```
   항상 진심 어린 사과와 함께 개선 의지를 표현하고,
   직접 연락 드릴 수 있도록 전화번호나 카카오톡 ID를 남겨주세요.
   ```
3. 저장
4. AI 답글 생성 페이지에서 **평점 1-2점 리뷰** 찾기
5. AI 답글 생성

#### 예상 결과:
- ✅ 진심 어린 사과로 시작
- ✅ 고객의 불편 사항을 구체적으로 언급
- ✅ 개선 의지 표현
- ✅ 연락처 정보 포함

---

### 테스트 9: 초기화 기능

#### 단계:
1. AI 설정 페이지에서 설정을 이상한 값으로 변경
   - 친절함: 1
   - 격식: 1
2. **초기화** 버튼 클릭

#### 예상 결과:
- ✅ 모든 설정이 기본값으로 돌아감
- ✅ "기본 설정으로 초기화되었습니다" 메시지 표시

---

### 테스트 10: 우측 상단 "AI 설정" 버튼

#### 단계:
1. AI 답글 생성 페이지에서 우측 상단 **"AI 설정"** 버튼 클릭

#### 예상 결과:
- ✅ AI 설정 페이지로 이동
- ✅ 현재 선택된 매장의 설정이 표시됨

---

## 🐛 예상 문제 및 해결 방법

### 문제 1: 404 에러 (Store not found)

**원인**: Migration이 적용되지 않았거나, store_id가 잘못됨

**해결**:
```sql
-- stores 테이블에 ai_settings 컬럼이 있는지 확인
SELECT column_name FROM information_schema.columns WHERE table_name = 'stores';
```

### 문제 2: 설정이 저장되지 않음

**원인**: 백엔드 API 에러

**해결**:
1. 백엔드 로그 확인
2. Supabase 연결 확인
3. 환경변수 확인 (SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY)

### 문제 3: AI 답글에 설정이 반영되지 않음

**원인**: 프론트엔드에서 설정을 전달하지 않음

**해결**:
- 브라우저 콘솔에서 확인:
  ```javascript
  console.log('aiSettings:', aiSettings)
  ```
- 백엔드 로그 확인:
  ```
  Using custom AI settings: friendliness=X, formality=Y
  ```

---

## ✅ 최종 체크리스트

- [ ] Migration 적용 완료 (ai_settings 컬럼 존재)
- [ ] AI 설정 페이지 접속 가능
- [ ] 매장 선택 시 기본 설정 로드
- [ ] 설정 변경 및 저장 성공
- [ ] 페이지 새로고침 후 설정 유지
- [ ] 매장별 다른 설정 저장
- [ ] AI 답글 생성 시 설정 반영 확인
- [ ] 친절함/격식 수준에 따라 톤 변화 확인
- [ ] 커스텀 지시사항 반영 확인
- [ ] 부정 리뷰 대응 확인
- [ ] 초기화 기능 작동 확인
- [ ] "AI 설정" 버튼으로 페이지 이동 확인

---

## 📊 성공 기준

### 기능적 성공
- ✅ 모든 테스트 시나리오 통과
- ✅ 매장별 설정 독립 저장
- ✅ 설정이 AI 답글에 명확히 반영됨

### 사용자 경험
- ✅ 직관적인 UI/UX
- ✅ 빠른 응답 속도 (< 3초)
- ✅ 명확한 피드백 메시지

### 코드 품질
- ✅ 에러 핸들링 완료
- ✅ 로그 출력 적절
- ✅ 백엔드/프론트엔드 연동 완벽

---

## 📝 테스트 결과 기록

테스트를 진행하면서 다음 표를 채워주세요:

| 테스트 번호 | 테스트 명 | 결과 | 비고 |
|------------|----------|------|------|
| 1 | AI 설정 페이지 접속 | ⬜ PASS / ⬜ FAIL | |
| 2 | AI 설정 저장 | ⬜ PASS / ⬜ FAIL | |
| 3 | 설정 로드 확인 | ⬜ PASS / ⬜ FAIL | |
| 4 | 매장별 다른 설정 | ⬜ PASS / ⬜ FAIL | |
| 5 | AI 답글 생성 (매장 A) | ⬜ PASS / ⬜ FAIL | |
| 6 | AI 답글 생성 (매장 B) | ⬜ PASS / ⬜ FAIL | |
| 7 | 커스텀 지시사항 | ⬜ PASS / ⬜ FAIL | |
| 8 | 부정 리뷰 대응 | ⬜ PASS / ⬜ FAIL | |
| 9 | 초기화 기능 | ⬜ PASS / ⬜ FAIL | |
| 10 | AI 설정 버튼 | ⬜ PASS / ⬜ FAIL | |
